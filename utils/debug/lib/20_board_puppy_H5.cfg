if { [info exists PUPPY_TYPE] } {
    if { "$PUPPY_TYPE" in {"xbuddy_extension"} } {
        echo "Puppy is expected to be $PUPPY_TYPE"
    } else {
        echo "Invalid puppy type: $PUPPY_TYPE"
        shutdown
    }
} else {
    echo "No puppy type set. Defaulting to \"xbuddy_extension\"."
    set PUPPY_TYPE "xbuddy_extension"
}

set setup_debugger_puppy_proc setup_debugger_$PUPPY_TYPE
if { $setup_debugger_puppy_proc in [info commands] } {
    $setup_debugger_puppy_proc
} else {
    echo "No debugger configuration provided. Defaulting to any STLink..."
    use_stlink_dap
}

set CHIPNAME $PUPPY_TYPE

set STOP_WATCHDOG 1

source [find target/stm32h5x.cfg]

adapter speed 8000

# The h5 script from ST's openocd doesn't define _TARGETNAME
if { ![info exists _TARGETNAME] } {
    set _TARGETNAME $_CHIPNAME.cpu
}

$_TARGETNAME configure -event reset-start {
	adapter speed 8000
}

$_TARGETNAME configure -event reset-init {
    adapter speed 1800
}

$_TARGETNAME configure -event gdb-detach {
    shutdown
}
